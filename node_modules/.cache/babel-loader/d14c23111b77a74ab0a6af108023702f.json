{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'./BillsList.css';import*as fromBillsApi from'../../api/bills';import Modal from\"react-bootstrap4-modal\";import moment from'moment';import*as fromUsersApi from'../../api/users';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var BillsList=/*#__PURE__*/function(_React$Component){_inherits(BillsList,_React$Component);var _super=_createSuper(BillsList);function BillsList(props){var _this;_classCallCheck(this,BillsList);_this=_super.call(this,props);_this.state={idFraisForfait:['KM','NUI','REP'],visible:false,quantite:'',mois:'',bills:[],users:[],fraishorsforfait:[],kmQty:0,nightsQty:0,repasQty:0,profileImg:''};return _this;}_createClass(BillsList,[{key:\"handleChange\",value:function handleChange(e){e.preventDefault();var name=e.target.name;this.setState(_defineProperty({},name,e.target.value));}},{key:\"handleRowsChange\",value:function handleRowsChange(e,i){e.preventDefault();var _e$target=e.target,name=_e$target.name,value=_e$target.value;var fraishorsforfait=_toConsumableArray(this.state.fraishorsforfait);fraishorsforfait[i]=_objectSpread(_objectSpread({},fraishorsforfait[i]),{},_defineProperty({},name,value));this.setState({fraishorsforfait:fraishorsforfait});}},{key:\"ShowModal\",value:function ShowModal(){this.setState({visible:!this.state.visible});}},{key:\"getLignes\",value:function(){var _getLignes=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(mois){var id,ligneff,lignefhf;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:id=localStorage.getItem('id');_context.next=3;return fromBillsApi.getLigneFraisForfait(id,mois);case 3:ligneff=_context.sent;_context.next=6;return fromBillsApi.getLigneFraisHorsForfait(id,mois);case 6:lignefhf=_context.sent;lignefhf.result.map(function(ligne,i){ligne.date=moment(ligne.date).format(\"YYYY-MM-DD\");});this.setState({kmQty:ligneff.result[0].quantite,nightsQty:ligneff.result[1].quantite,repasQty:ligneff.result[2].quantite,fraishorsforfait:lignefhf.result,mois:mois});case 9:case\"end\":return _context.stop();}}},_callee,this);}));function getLignes(_x){return _getLignes.apply(this,arguments);}return getLignes;}()},{key:\"update\",value:function(){var _update=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _this2=this;var idUser;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:idUser=localStorage.getItem('id');_context3.next=3;return fromBillsApi.putLigneFraisForfait(idUser,this.state.mois,this.state.idFraisForfait[0],this.state.kmQty);case 3:_context3.next=5;return fromBillsApi.putLigneFraisForfait(idUser,this.state.mois,this.state.idFraisForfait[1],this.state.nightsQty);case 5:_context3.next=7;return fromBillsApi.putLigneFraisForfait(idUser,this.state.mois,this.state.idFraisForfait[2],this.state.repasQty);case 7:this.state.fraishorsforfait.map(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(f,i){var horsforfait;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fromBillsApi.putLigneFraisHorsForfait(f.id,_defineProperty({idutilisateur:idUser,mois:_this2.state.mois,libelle:f.libelle,date:f.date,montant:f.montant},\"libelle\",f.libelle));case 2:horsforfait=_context2.sent;case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2,_x3){return _ref.apply(this,arguments);};}());this.setState({visible:!this.state.visible});case 9:case\"end\":return _context3.stop();}}},_callee3,this);}));function update(){return _update.apply(this,arguments);}return update;}()},{key:\"addRows\",value:function addRows(){this.setState({fraishorsforfait:[].concat(_toConsumableArray(this.state.fraishorsforfait),[{date:'',libelle:'',montant:'',justificatif:''}])});}},{key:\"removeRows\",value:function removeRows(i){var row=this.state.fraishorsforfait;row.splice(i,1);this.setState({fraishorsforfait:row});}},{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var id,bills;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:id=localStorage.getItem('id');_context4.next=3;return fromBillsApi.getBills(id);case 3:bills=_context4.sent;this.setState({bills:bills.result});case 5:case\"end\":return _context4.stop();}}},_callee4,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/_jsx(\"main\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"br\",{}),\" \",/*#__PURE__*/_jsx(\"h3\",{className:\"mt-5\",children:\"Bonjour, voici vos fiches de frais : \"}),\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"table\",{className:\"table table-hover\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Mois\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Justificatifs\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Montant\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Date de modification\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Etat\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Action\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:this.state.bills.map(function(bill,i){bill.dateModif=moment(bill.dateModif,'YYYY-MM-DD[T]HH:mm:ss').format(\"DD-MM-YYYY\");return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"row\",children:bill.mois}),/*#__PURE__*/_jsx(\"td\",{children:bill.nbJustificatifs}),/*#__PURE__*/_jsx(\"td\",{children:bill.montantValide}),/*#__PURE__*/_jsx(\"td\",{children:bill.dateModif}),/*#__PURE__*/_jsx(\"td\",{children:bill.idEtat}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"btn btn-info btn-sm\",\"data-action\":\"update\",onClick:function onClick(){_this3.ShowModal();_this3.getLignes(bill.mois);},children:/*#__PURE__*/_jsx(\"i\",{class:\"fas fa-edit\"})})})]});})})]}),/*#__PURE__*/_jsxs(Modal,{visible:this.state.visible,dialogClassName:\"modal-80w font-size center modal-fond modal-dialog-scrollable\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"modal-title\",children:[\"Modification Fiche Frais de \",this.state.mois,\" \"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-danger\",onClick:function onClick(){return _this3.ShowModal();},children:/*#__PURE__*/_jsx(\"i\",{class:\"fas fa-times\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"centrer\",children:\"Frais Forfait \"}),/*#__PURE__*/_jsx(\"div\",{className:\"card border-primary\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table text-center\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Frais \"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Quantit\\xE9\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Montant unitaire\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Total\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"label\",{className:\"form-control-label\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Nuit\\xE9es\"})})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"nightsQty\",placeholder:\"Qt\\xE9\",value:this.state.nightsQty,onChange:function onChange(e){return _this3.handleChange(e);}})}),/*#__PURE__*/_jsx(\"td\",{children:\"80\\u20AC\"}),/*#__PURE__*/_jsxs(\"td\",{children:[this.state.nightsQty*80,\"\\u20AC\"]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"label\",{for:\"\",className:\"form-control-label\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Repas\"})})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"repasQty\",placeholder:\"Qt\\xE9\",value:this.state.repasQty,onChange:function onChange(e){return _this3.handleChange(e);}})}),/*#__PURE__*/_jsx(\"td\",{children:\"29\\u20AC\"}),/*#__PURE__*/_jsx(\"td\",{children:this.state.repasQty*29})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"label\",{for:\"\",className:\"form-control-label\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Kilom\\xE9trage\"})})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"kmQty\",placeholder:\"Qt\\xE9\",value:this.state.kmQty,onChange:function onChange(e){return _this3.handleChange(e);}})}),/*#__PURE__*/_jsx(\"td\",{children:\"0.6\\u20AC\"}),/*#__PURE__*/_jsx(\"td\",{children:this.state.kmQty*0.6})]})]})]})})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h5\",{className:\"centrer\",children:\"Frais Hors Forfait \"}),/*#__PURE__*/_jsx(\"div\",{className:\"card border-primary\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-success btn-sm\",onClick:function onClick(){return _this3.addRows();},children:\"Ajoutez un frais hors forfait\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"table text-center\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Dates\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Libell\\xE9\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Montant\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\" Justificatifs\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\" Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:this.state.fraishorsforfait.map(function(f,i){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"date\",value:_this3.state.fraishorsforfait[i].date,onChange:function onChange(e){return _this3.handleRowsChange(e,i);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Libell\\xE9\",name:\"libelle\",value:_this3.state.fraishorsforfait[i].libelle,onChange:function onChange(e){return _this3.handleRowsChange(e,i);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text   \",placeholder:\"Montant\",name:\"montant\",value:_this3.state.fraishorsforfait[i].montant,onChange:function onChange(e){return _this3.handleRowsChange(e,i);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"justificatif\",value:_this3.state.fraishorsforfait[i].justificatif,onChange:function onChange(e){return _this3.handleRowsChange(e,i);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-danger btn-sm mr-2\",\"data-action\":\"delete\",onClick:function onClick(){return _this3.removeRows(i);},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash\"})})})]},i);})})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-success\",onClick:function onClick(){return _this3.update();},children:\"Enregistrer\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-light\",onClick:function onClick(){return _this3.ShowModal();},children:\"Annuler\"})]})]})]})});}}]);return BillsList;}(React.Component);export default BillsList;","map":{"version":3,"sources":["C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/src/components/billsList/BillsList.js"],"names":["React","fromBillsApi","Modal","moment","fromUsersApi","BillsList","props","state","idFraisForfait","visible","quantite","mois","bills","users","fraishorsforfait","kmQty","nightsQty","repasQty","profileImg","e","preventDefault","name","target","setState","value","i","id","localStorage","getItem","getLigneFraisForfait","ligneff","getLigneFraisHorsForfait","lignefhf","result","map","ligne","date","format","idUser","putLigneFraisForfait","f","putLigneFraisHorsForfait","idutilisateur","libelle","montant","horsforfait","justificatif","row","splice","getBills","bill","dateModif","nbJustificatifs","montantValide","idEtat","ShowModal","getLignes","handleChange","addRows","handleRowsChange","removeRows","update","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport './BillsList.css';\nimport * as fromBillsApi from '../../api/bills'\nimport Modal from \"react-bootstrap4-modal\";\nimport moment from 'moment'\nimport  * as fromUsersApi from '../../api/users'\n\n\nclass BillsList extends React.Component {\n\n    constructor(props) {\n        super(props)\n\n        this.state = ({\n            idFraisForfait: ['KM' , 'NUI', 'REP'],\n            visible: false,\n            quantite:'',\n            mois:'',\n            bills: [],\n            users:[],\n            fraishorsforfait: [],\n            kmQty:0,\n            nightsQty:0,\n            repasQty:0,\n            profileImg:''\n        })\n\n    }\n\n    handleChange(e){\n        e.preventDefault()\n        let name = e.target.name\n        this.setState({\n            [name]: e.target.value\n        })\n    }\n\n    handleRowsChange(e, i){\n        e.preventDefault()\n        let {name, value } = e.target\n        let fraishorsforfait = [...this.state.fraishorsforfait]\n        fraishorsforfait[i] = {\n            ...fraishorsforfait[i],\n            [name] : value\n        }\n        this.setState({\n            fraishorsforfait : fraishorsforfait    \n        })\n    }\n\n    ShowModal() {\n        \n        this.setState({\n            visible: !this.state.visible\n        })\n    }\n\n    async getLignes(mois) {\n \n        let id = localStorage.getItem('id')\n        let ligneff = await fromBillsApi.getLigneFraisForfait(id, mois)\n        let lignefhf = await fromBillsApi.getLigneFraisHorsForfait(id,mois)\n        lignefhf.result.map((ligne,i) => {\n\n            ligne.date = moment(ligne.date).format(\"YYYY-MM-DD\")\n        })\n        \n        this.setState({\n            kmQty: ligneff.result[0].quantite,\n            nightsQty: ligneff.result[1].quantite,\n            repasQty: ligneff.result[2].quantite,\n            fraishorsforfait: lignefhf.result,\n            mois: mois\n\n        })\n\n    }\n\n    async update() {\n        let idUser = localStorage.getItem('id')\n        \n        await fromBillsApi.putLigneFraisForfait(idUser, this.state.mois, this.state.idFraisForfait[0],this.state.kmQty)\n        await fromBillsApi.putLigneFraisForfait(idUser, this.state.mois, this.state.idFraisForfait[1],this.state.nightsQty)\n        await fromBillsApi.putLigneFraisForfait(idUser, this.state.mois, this.state.idFraisForfait[2],this.state.repasQty)\n        \n        this.state.fraishorsforfait.map(async (f,i) => {\n            let horsforfait = await fromBillsApi.putLigneFraisHorsForfait(f.id, {idutilisateur : idUser, mois: this.state.mois, libelle : f.libelle, date : f.date, montant : f.montant, libelle: f.libelle})\n        })\n\n        \n        this.setState({\n            visible : !this.state.visible\n        })\n    }\n\n    addRows() {\n        \n        this.setState({\n            fraishorsforfait: [...this.state.fraishorsforfait, {date: '' , libelle: '', montant: '', justificatif: ''}]\n        })\n    }\n    removeRows(i){\n        let row = this.state.fraishorsforfait\n        row.splice(i,1)\n        this.setState({\n            fraishorsforfait:row\n        })\n    }\n\n    async componentDidMount() {\n        let id = localStorage.getItem('id')\n        let bills = await fromBillsApi.getBills(id)\n        this.setState({ \n            bills: bills.result,\n            \n        })\n\n        \n    }\n\n\n    render() {\n\n        return (\n\n            <main className=\"flex-shrink-0\">\n                <div className=\"container\">\n                   <br/> <h3 className=\"mt-5\">Bonjour, voici vos fiches de frais : </h3> <br/>\n                    <table className=\"table table-hover\">\n                        <thead>\n                            <tr>\n                                <th scope=\"col\">Mois</th>\n                                <th scope=\"col\">Justificatifs</th>\n                                <th scope=\"col\">Montant</th>\n                                <th scope=\"col\">Date de modification</th>\n                                <th scope=\"col\">Etat</th>\n                                <th scope=\"col\">Action</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            {\n                                this.state.bills.map((bill, i) => {\n                                \n                                   bill.dateModif = moment(bill.dateModif,'YYYY-MM-DD[T]HH:mm:ss').format(\"DD-MM-YYYY\")\n                                    return (\n                                        <tr>\n                                            <th scope=\"row\">{bill.mois}</th>\n                                            <td>{bill.nbJustificatifs}</td>\n                                            <td>{bill.montantValide}</td>\n                                            <td>{bill.dateModif}</td>\n                                            <td>{bill.idEtat}</td>\n                                            <td>\n                                                <button type=\"button\" class=\"btn btn-info btn-sm\" data-action=\"update\" onClick={() => {this.ShowModal(); this.getLignes(bill.mois)}}>\n                                                    <i class=\"fas fa-edit\"></i>\n                                                </button>\n                                            </td>\n                                        </tr>\n                                    )\n                                    \n                                })\n                            }\n                        </tbody>\n                    </table>\n                    <Modal visible={this.state.visible} dialogClassName=\"modal-80w font-size center modal-fond modal-dialog-scrollable\">\n                            \n                        <div className=\"modal-header\">\n                            <h4 className=\"modal-title\">Modification Fiche Frais de {this.state.mois} </h4>\n                            <button type=\"button\" className=\"btn btn-danger\" onClick={() => this.ShowModal()}>\n                                <i class=\"fas fa-times\"></i>\n                            </button>\n                        </div>\n                        <div className=\"modal-body\">\n                        \n                            <h5 className=\"centrer\">Frais Forfait </h5>\n                            <div className=\"card border-primary\">\n                                <div className=\"card-body\">\n                                    <table className=\"table text-center\">\n                                        <thead>\n                                            <tr>\n                                                <th scope=\"col\">Frais </th>\n                                                <th scope=\"col\">Quantité</th>\n                                                <th scope=\"col\">Montant unitaire</th>\n                                                <th scope=\"col\">Total</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                            <tr>\n                                                <td><label className=\"form-control-label\"><strong>Nuitées</strong></label></td>\n                                                <td><input type=\"text\" name=\"nightsQty\" placeholder=\"Qté\" value={this.state.nightsQty} onChange={(e) => this.handleChange(e)} /></td>\n                                                <td>80€</td>\n                                                <td>{this.state.nightsQty * 80}€</td>\n                                            </tr>\n                                            <tr>\n                                                <td><label for=\"\" className=\"form-control-label\"><strong>Repas</strong></label></td>\n                                                <td><input type=\"text\" name=\"repasQty\" placeholder=\"Qté\" value={this.state.repasQty} onChange={(e) => this.handleChange(e)} /></td>\n                                                <td>29€</td>\n                                                <td>{this.state.repasQty * 29}</td>\n                                            </tr>\n                                            <tr>\n                                                <td><label for=\"\" className=\"form-control-label\"><strong>Kilométrage</strong></label></td>\n                                                <td><input type=\"text\" name=\"kmQty\" placeholder=\"Qté\" value={this.state.kmQty} onChange={(e) => this.handleChange(e)} /></td>\n                                                <td>0.6€</td>\n                                                <td>{this.state.kmQty * 0.6}</td>\n                                            </tr>\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n\n                            <br />\n                            <h5 className=\"centrer\">Frais Hors Forfait </h5>\n                            <div className=\"card border-primary\">\n                                <div className=\"card-body\">\n                                <button type=\"button\" className=\"btn btn-success btn-sm\" onClick={() => this.addRows()}>Ajoutez un frais hors forfait</button>\n                                    <table className=\"table text-center\">\n                                        <thead>                                \n                                        \n                                            <tr> \n                                                <th scope=\"col\">Dates</th>\n                                                <th scope=\"col\">Libellé</th>\n                                                <th scope=\"col\">Montant</th>\n                                                <th scope=\"col\"> Justificatifs</th>\n                                                <th scope=\"col\"> Actions</th>\n                                            </tr>\n                                        </thead>\n                                        \n                                        <tbody>\n                                        \n                                            {\n                                                \n                                                this.state.fraishorsforfait.map((f, i) => {\n                                                    return (\n                                                        <tr key={i}>\n                                                            <td><input type=\"date\" name=\"date\" value={this.state.fraishorsforfait[i].date} onChange={(e) => this.handleRowsChange(e,i)}/></td>\n                                                            <td><input type=\"text\" placeholder=\"Libellé\" name=\"libelle\" value={this.state.fraishorsforfait[i].libelle} onChange={(e) => this.handleRowsChange(e,i)}/></td>\n                                                            <td><input type=\"text   \" placeholder=\"Montant\" name=\"montant\" value={this.state.fraishorsforfait[i].montant} onChange={(e) => this.handleRowsChange(e,i)}/></td>\n                                                            <td><input type=\"file\" name=\"justificatif\" value={this.state.fraishorsforfait[i].justificatif} onChange={(e) => this.handleRowsChange(e,i)}/></td>\n                                                            <td>\n                                                                <button type=\"button\" className=\"btn btn-danger btn-sm mr-2\" data-action=\"delete\" onClick={() => this.removeRows(i)}>\n                                                                    <i className=\"fas fa-trash\"></i>\n                                                                </button>\n                                                            </td>\n                                                        </tr>\n                                                    )\n                                                })\n                                                \n                                            }\n                                            \n                                            \n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n\n                        </div>\n                        <div className=\"modal-footer\">\n                            <button type=\"button\" className=\"btn btn-success\" onClick={() => this.update()}>\n                                Enregistrer\n                            </button>\n                            <button type=\"button\" className=\"btn btn-light\" onClick={() => this.ShowModal()}>\n                                Annuler\n                            </button>\n                        </div>\n                    \n                    </Modal>\n                </div>\n\n            </main>\n\n        )\n\n    }\n\n\n}\n\nexport default BillsList;\n"]},"metadata":{},"sourceType":"module"}