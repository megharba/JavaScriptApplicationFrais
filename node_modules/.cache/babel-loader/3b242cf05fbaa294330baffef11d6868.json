{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'./CreateBill.css';import{withRouter}from\"react-router-dom\";import*as fromBillsApi from'../../api/bills';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var CreateBill=/*#__PURE__*/function(_React$Component){_inherits(CreateBill,_React$Component);var _super=_createSuper(CreateBill);function CreateBill(props){var _this;_classCallCheck(this,CreateBill);_this=_super.call(this,props);_this.state={fraisforfait:[],fraishorsforfait:[],nightsQty:0,repasQty:0,kmQty:0,date:'',anneeMois:''};return _this;}_createClass(CreateBill,[{key:\"handleChange\",value:function handleChange(e){e.preventDefault();var name=e.target.name;this.setState(_defineProperty({},name,e.target.value));}},{key:\"handleRowsChange\",value:function handleRowsChange(e,i){var _this2=this;e.preventDefault();var _e$target=e.target,name=_e$target.name,value=_e$target.value;var fraishorsforfait=_toConsumableArray(this.state.fraishorsforfait);fraishorsforfait[i]=_objectSpread(_objectSpread({},fraishorsforfait[i]),{},_defineProperty({},name,value));this.setState({fraishorsforfait:fraishorsforfait},function(){return console.log(_this2.state.fraishorsforfait);});}},{key:\"addRows\",value:function addRows(){this.setState({fraishorsforfait:[].concat(_toConsumableArray(this.state.fraishorsforfait),[{date:'',libelle:'',montant:'',justificatif:''}])});}},{key:\"removeRows\",value:function removeRows(i){var row=this.state.fraishorsforfait;row.splice(i,1);this.setState({fraishorsforfait:row});}},{key:\"postFiche\",value:function(){var _postFiche=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this3=this;var idUser,fiche,km,night,meals;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:idUser=localStorage.getItem('id');_context2.next=3;return fromBillsApi.postAddFiche({idutilisateur:idUser,mois:this.state.anneeMois,nbJustificatifs:\"1\",montantValide:this.state.nightsQty*80+this.state.repasQty*29+this.state.kmQty*0.6,dateModif:this.state.date,idEtat:'CR'});case 3:fiche=_context2.sent;_context2.next=6;return fromBillsApi.postLigneFraisForfait({idutilisateur:idUser,mois:this.state.anneeMois,idFraisForfait:'KM',quantite:this.state.kmQty});case 6:km=_context2.sent;_context2.next=9;return fromBillsApi.postLigneFraisForfait({idutilisateur:idUser,mois:this.state.anneeMois,idFraisForfait:'NUI',quantite:this.state.nightsQty});case 9:night=_context2.sent;_context2.next=12;return fromBillsApi.postLigneFraisForfait({idutilisateur:idUser,mois:this.state.anneeMois,idFraisForfait:'REP',quantite:this.state.repasQty});case 12:meals=_context2.sent;this.state.fraishorsforfait.map(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(f,i){var horsforfait;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fromBillsApi.postLigneFraisHorsForfait({idutilisateur:idUser,mois:_this3.state.anneeMois,libelle:f.libelle,date:f.date,montant:f.montant,justificatif:f.libelle});case 2:horsforfait=_context.sent;case 3:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}());this.props.history.push('/accueil');case 15:case\"end\":return _context2.stop();}}},_callee2,this);}));function postFiche(){return _postFiche.apply(this,arguments);}return postFiche;}()},{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var months,numMonth,year,monthText,tabMois,numMois,mois;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:months=['Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août','Septembre','Octobre','Novembre','Décembre'];numMonth=new Date().getMonth();year=new Date().getFullYear();months.map(function(month,i){if(i==numMonth)monthText=month;});tabMois=['01','02','03','04','05','06','07','08','09','10','11','12'];numMois=new Date().getMonth();tabMois.map(function(num,i){if(i==numMois)mois=num;});this.setState({date:\" de \".concat(monthText,\" \").concat(year),anneeMois:year+mois});case 8:case\"end\":return _context3.stop();}}},_callee3,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this4=this;return/*#__PURE__*/_jsx(\"main\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"h1\",{class:\"text-center pt100\",children:[\"Fiche de remboursement du mois \",this.state.date]}),/*#__PURE__*/_jsx(\"hr\",{className:\"ligne\"}),/*#__PURE__*/_jsx(\"h5\",{className:\"centrer\",children:\"Frais Forfait \"}),/*#__PURE__*/_jsx(\"div\",{className:\"card border-primary\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table text-center\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Frais \"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Quantit\\xE9\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Montant unitaire\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Total\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"label\",{className:\"form-control-label\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Nuit\\xE9es\"})})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"nightsQty\",placeholder:\"Qt\\xE9\",value:this.state.nightsQty,onChange:function onChange(e){return _this4.handleChange(e);}})}),/*#__PURE__*/_jsx(\"td\",{children:\"80\\u20AC\"}),/*#__PURE__*/_jsxs(\"td\",{children:[this.state.nightsQty*80,\"\\u20AC\"]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"label\",{for:\"\",className:\"form-control-label\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Repas\"})})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"repasQty\",placeholder:\"Qt\\xE9\",value:this.state.repasQty,onChange:function onChange(e){return _this4.handleChange(e);}})}),/*#__PURE__*/_jsx(\"td\",{children:\"29\\u20AC\"}),/*#__PURE__*/_jsx(\"td\",{children:this.state.repasQty*29})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"label\",{for:\"\",className:\"form-control-label\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Kilom\\xE9trage\"})})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"kmQty\",placeholder:\"Qt\\xE9\",value:this.state.kmQty,onChange:function onChange(e){return _this4.handleChange(e);}})}),/*#__PURE__*/_jsx(\"td\",{children:\"0.6\\u20AC\"}),/*#__PURE__*/_jsx(\"td\",{children:this.state.kmQty*0.6})]})]})]})})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h5\",{className:\"centrer\",children:\"Frais Hors Forfait \"}),/*#__PURE__*/_jsx(\"div\",{className:\"card border-primary\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-success btn-sm\",onClick:function onClick(){return _this4.addRows();},children:\"Ajoutez un frais hors forfait\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"table text-center\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Dates\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Libell\\xE9\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Montant\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\" Justificatifs\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\" Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:this.state.fraishorsforfait.map(function(f,i){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"date\",value:_this4.state.fraishorsforfait[i].date,onChange:function onChange(e){return _this4.handleRowsChange(e,i);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Libell\\xE9\",name:\"libelle\",value:_this4.state.fraishorsforfait[i].libelle,onChange:function onChange(e){return _this4.handleRowsChange(e,i);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text   \",placeholder:\"Montant\",name:\"montant\",value:_this4.state.fraishorsforfait[i].montant,onChange:function onChange(e){return _this4.handleRowsChange(e,i);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"justificatif\",value:_this4.state.fraishorsforfait[i].justificatif,onChange:function onChange(e){return _this4.handleRowsChange(e,i);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-danger btn-sm mr-2\",\"data-action\":\"delete\",onClick:function onClick(){return _this4.removeRows(i);},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash\"})})})]},i);})})]})]})}),/*#__PURE__*/_jsx(\"div\",{class:\"col text-center\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",class:\"btn btn-primary mt-3 mb-3\",onClick:function onClick(){return _this4.postFiche();},children:\"Cr\\xE9er la fiche \"})})]})});}}]);return CreateBill;}(React.Component);export default withRouter(CreateBill);","map":{"version":3,"sources":["C:/Users/Bruno Megharba/OneDrive/Documents/GSBAPP/GSBFront-main/src/components/createBill/CreateBill.js"],"names":["React","withRouter","fromBillsApi","CreateBill","props","state","fraisforfait","fraishorsforfait","nightsQty","repasQty","kmQty","date","anneeMois","e","preventDefault","name","target","setState","value","i","console","log","libelle","montant","justificatif","row","splice","idUser","localStorage","getItem","postAddFiche","idutilisateur","mois","nbJustificatifs","montantValide","dateModif","idEtat","fiche","postLigneFraisForfait","idFraisForfait","quantite","km","night","meals","map","f","postLigneFraisHorsForfait","horsforfait","history","push","months","numMonth","Date","getMonth","year","getFullYear","month","monthText","tabMois","numMois","num","handleChange","addRows","handleRowsChange","removeRows","postFiche","Component"],"mappings":"4lDAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAO,kBAAP,CACA,OAAQC,UAAR,KAA0B,kBAA1B,CACA,MAAO,GAAKC,CAAAA,YAAZ,KAA8B,iBAA9B,C,2FAGMC,CAAAA,U,oHACF,oBAAYC,KAAZ,CAAmB,4CACf,uBAAMA,KAAN,EAEA,MAAKC,KAAL,CAAa,CACTC,YAAY,CAAE,EADL,CAETC,gBAAgB,CAAE,EAFT,CAGTC,SAAS,CAAC,CAHD,CAITC,QAAQ,CAAC,CAJA,CAKTC,KAAK,CAAC,CALG,CAMTC,IAAI,CAAC,EANI,CAOTC,SAAS,CAAC,EAPD,CAAb,CAHe,aAalB,C,mDAED,sBAAaC,CAAb,CAAe,CACXA,CAAC,CAACC,cAAF,GACA,GAAIC,CAAAA,IAAI,CAAGF,CAAC,CAACG,MAAF,CAASD,IAApB,CACA,KAAKE,QAAL,oBACKF,IADL,CACYF,CAAC,CAACG,MAAF,CAASE,KADrB,GAGH,C,gCAED,0BAAiBL,CAAjB,CAAoBM,CAApB,CAAsB,iBAClBN,CAAC,CAACC,cAAF,GADkB,cAEGD,CAAC,CAACG,MAFL,CAEbD,IAFa,WAEbA,IAFa,CAEPG,KAFO,WAEPA,KAFO,CAGlB,GAAIX,CAAAA,gBAAgB,oBAAO,KAAKF,KAAL,CAAWE,gBAAlB,CAApB,CACAA,gBAAgB,CAACY,CAAD,CAAhB,gCACOZ,gBAAgB,CAACY,CAAD,CADvB,wBAEKJ,IAFL,CAEaG,KAFb,GAIA,KAAKD,QAAL,CAAc,CACVV,gBAAgB,CAAGA,gBADT,CAAd,CAEG,iBAAMa,CAAAA,OAAO,CAACC,GAAR,CAAY,MAAI,CAAChB,KAAL,CAAWE,gBAAvB,CAAN,EAFH,EAGH,C,uBAED,kBAAU,CACN,KAAKU,QAAL,CAAc,CACVV,gBAAgB,8BAAM,KAAKF,KAAL,CAAWE,gBAAjB,GAAmC,CAACI,IAAI,CAAE,EAAP,CAAWW,OAAO,CAAE,EAApB,CAAwBC,OAAO,CAAE,EAAjC,CAAqCC,YAAY,CAAE,EAAnD,CAAnC,EADN,CAAd,EAGH,C,0BACD,oBAAWL,CAAX,CAAa,CACT,GAAIM,CAAAA,GAAG,CAAG,KAAKpB,KAAL,CAAWE,gBAArB,CACAkB,GAAG,CAACC,MAAJ,CAAWP,CAAX,CAAa,CAAb,EACA,KAAKF,QAAL,CAAc,CACVV,gBAAgB,CAACkB,GADP,CAAd,EAGH,C,2GAID,wLACQE,MADR,CACiBC,YAAY,CAACC,OAAb,CAAqB,IAArB,CADjB,wBAGsB3B,CAAAA,YAAY,CAAC4B,YAAb,CAA0B,CAACC,aAAa,CAAGJ,MAAjB,CAAyBK,IAAI,CAAE,KAAK3B,KAAL,CAAWO,SAA1C,CAAqDqB,eAAe,CAAE,GAAtE,CAA2EC,aAAa,CAAE,KAAK7B,KAAL,CAAWG,SAAX,CAAqB,EAArB,CAAwB,KAAKH,KAAL,CAAWI,QAAX,CAAoB,EAA5C,CAA+C,KAAKJ,KAAL,CAAWK,KAAX,CAAiB,GAA1J,CAAgKyB,SAAS,CAAG,KAAK9B,KAAL,CAAWM,IAAvL,CAA8LyB,MAAM,CAAG,IAAvM,CAA1B,CAHtB,QAGQC,KAHR,uCAOmBnC,CAAAA,YAAY,CAACoC,qBAAb,CAAmC,CAACP,aAAa,CAAGJ,MAAjB,CAAyBK,IAAI,CAAE,KAAK3B,KAAL,CAAWO,SAA1C,CAAqD2B,cAAc,CAAG,IAAtE,CAA4EC,QAAQ,CAAG,KAAKnC,KAAL,CAAWK,KAAlG,CAAnC,CAPnB,QAOQ+B,EAPR,uCAQsBvC,CAAAA,YAAY,CAACoC,qBAAb,CAAmC,CAACP,aAAa,CAAGJ,MAAjB,CAAyBK,IAAI,CAAE,KAAK3B,KAAL,CAAWO,SAA1C,CAAqD2B,cAAc,CAAG,KAAtE,CAA6EC,QAAQ,CAAG,KAAKnC,KAAL,CAAWG,SAAnG,CAAnC,CARtB,QAQQkC,KARR,wCASsBxC,CAAAA,YAAY,CAACoC,qBAAb,CAAmC,CAACP,aAAa,CAAGJ,MAAjB,CAAyBK,IAAI,CAAE,KAAK3B,KAAL,CAAWO,SAA1C,CAAqD2B,cAAc,CAAG,KAAtE,CAA6EC,QAAQ,CAAG,KAAKnC,KAAL,CAAWI,QAAnG,CAAnC,CATtB,SASQkC,KATR,gBAUI,KAAKtC,KAAL,CAAWE,gBAAX,CAA4BqC,GAA5B,0FAAgC,iBAAOC,CAAP,CAAS1B,CAAT,wJACJjB,CAAAA,YAAY,CAAC4C,yBAAb,CAAuC,CAACf,aAAa,CAAGJ,MAAjB,CAAyBK,IAAI,CAAE,MAAI,CAAC3B,KAAL,CAAWO,SAA1C,CAAqDU,OAAO,CAAGuB,CAAC,CAACvB,OAAjE,CAA0EX,IAAI,CAAGkC,CAAC,CAAClC,IAAnF,CAAyFY,OAAO,CAAGsB,CAAC,CAACtB,OAArG,CAA8GC,YAAY,CAAGqB,CAAC,CAACvB,OAA/H,CAAvC,CADI,QACxByB,WADwB,qEAAhC,oEAKA,KAAK3C,KAAL,CAAW4C,OAAX,CAAmBC,IAAnB,CAAwB,UAAxB,EAfJ,8D,gNAqBA,gMAEQC,MAFR,CAEiB,CAAC,SAAD,CAAY,SAAZ,CAAuB,MAAvB,CAA+B,OAA/B,CAAwC,KAAxC,CAA+C,MAA/C,CAAuD,SAAvD,CAAkE,MAAlE,CAA0E,WAA1E,CAAuF,SAAvF,CAAkG,UAAlG,CAA8G,UAA9G,CAFjB,CAGQC,QAHR,CAGmB,GAAIC,CAAAA,IAAJ,GAAWC,QAAX,EAHnB,CAIQC,IAJR,CAIe,GAAIF,CAAAA,IAAJ,GAAWG,WAAX,EAJf,CAMIL,MAAM,CAACN,GAAP,CAAW,SAACY,KAAD,CAAQrC,CAAR,CAAc,CACrB,GAAGA,CAAC,EAAIgC,QAAR,CAAkBM,SAAS,CAAGD,KAAZ,CACrB,CAFD,EAKIE,OAXR,CAWkB,CAAC,IAAD,CAAM,IAAN,CAAY,IAAZ,CAAkB,IAAlB,CAAwB,IAAxB,CAA8B,IAA9B,CAAmC,IAAnC,CAAwC,IAAxC,CAA6C,IAA7C,CAAkD,IAAlD,CAAuD,IAAvD,CAA4D,IAA5D,CAXlB,CAYQC,OAZR,CAYkB,GAAIP,CAAAA,IAAJ,GAAWC,QAAX,EAZlB,CAcIK,OAAO,CAACd,GAAR,CAAY,SAACgB,GAAD,CAAMzC,CAAN,CAAY,CACpB,GAAIA,CAAC,EAAIwC,OAAT,CAAkB3B,IAAI,CAAG4B,GAAP,CACrB,CAFD,EAIA,KAAK3C,QAAL,CAAc,CACVN,IAAI,eAAU8C,SAAV,aAAuBH,IAAvB,CADM,CAEV1C,SAAS,CAAG0C,IAAI,CAAGtB,IAFT,CAAd,EAlBJ,6D,mIA2BA,iBAAS,iBACL,mBACI,aAAM,SAAS,CAAC,eAAhB,uBACI,aAAK,SAAS,CAAC,WAAf,wBAEI,YAAI,KAAK,CAAC,mBAAV,6CACoC,KAAK3B,KAAL,CAAWM,IAD/C,GAFJ,cAKQ,WAAI,SAAS,CAAC,OAAd,EALR,cAMQ,WAAI,SAAS,CAAC,SAAd,4BANR,cAOQ,YAAK,SAAS,CAAC,qBAAf,uBACI,YAAK,SAAS,CAAC,WAAf,uBACI,eAAO,SAAS,CAAC,mBAAjB,wBACI,oCACI,mCACI,WAAI,KAAK,CAAC,KAAV,oBADJ,cAEI,WAAI,KAAK,CAAC,KAAV,yBAFJ,cAGI,WAAI,KAAK,CAAC,KAAV,8BAHJ,cAII,WAAI,KAAK,CAAC,KAAV,mBAJJ,GADJ,EADJ,cASI,sCACI,mCACI,iCAAI,cAAO,SAAS,CAAC,oBAAjB,uBAAsC,sCAAtC,EAAJ,EADJ,cAEI,iCAAI,cAAO,IAAI,CAAC,MAAZ,CAAmB,IAAI,CAAC,WAAxB,CAAoC,WAAW,CAAC,QAAhD,CAAsD,KAAK,CAAE,KAAKN,KAAL,CAAWG,SAAxE,CAAmF,QAAQ,CAAE,kBAACK,CAAD,QAAO,CAAA,MAAI,CAACgD,YAAL,CAAkBhD,CAAlB,CAAP,EAA7F,EAAJ,EAFJ,cAGI,gCAHJ,cAII,sBAAK,KAAKR,KAAL,CAAWG,SAAX,CAAuB,EAA5B,YAJJ,GADJ,cAOI,mCACI,iCAAI,cAAO,GAAG,CAAC,EAAX,CAAc,SAAS,CAAC,oBAAxB,uBAA6C,iCAA7C,EAAJ,EADJ,cAEI,iCAAI,cAAO,IAAI,CAAC,MAAZ,CAAmB,IAAI,CAAC,UAAxB,CAAmC,WAAW,CAAC,QAA/C,CAAqD,KAAK,CAAE,KAAKH,KAAL,CAAWI,QAAvE,CAAiF,QAAQ,CAAE,kBAACI,CAAD,QAAO,CAAA,MAAI,CAACgD,YAAL,CAAkBhD,CAAlB,CAAP,EAA3F,EAAJ,EAFJ,cAGI,gCAHJ,cAII,oBAAK,KAAKR,KAAL,CAAWI,QAAX,CAAsB,EAA3B,EAJJ,GAPJ,cAaI,mCACI,iCAAI,cAAO,GAAG,CAAC,EAAX,CAAc,SAAS,CAAC,oBAAxB,uBAA6C,0CAA7C,EAAJ,EADJ,cAEI,iCAAI,cAAO,IAAI,CAAC,MAAZ,CAAmB,IAAI,CAAC,OAAxB,CAAgC,WAAW,CAAC,QAA5C,CAAkD,KAAK,CAAE,KAAKJ,KAAL,CAAWK,KAApE,CAA2E,QAAQ,CAAE,kBAACG,CAAD,QAAO,CAAA,MAAI,CAACgD,YAAL,CAAkBhD,CAAlB,CAAP,EAArF,EAAJ,EAFJ,cAGI,iCAHJ,cAII,oBAAK,KAAKR,KAAL,CAAWK,KAAX,CAAmB,GAAxB,EAJJ,GAbJ,GATJ,GADJ,EADJ,EAPR,cA0CQ,aA1CR,cA2CQ,WAAI,SAAS,CAAC,SAAd,iCA3CR,cA4CQ,YAAK,SAAS,CAAC,qBAAf,uBACI,aAAK,SAAS,CAAC,WAAf,wBACA,eAAQ,IAAI,CAAC,QAAb,CAAsB,SAAS,CAAC,wBAAhC,CAAyD,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACoD,OAAL,EAAN,EAAlE,2CADA,cAEI,eAAO,SAAS,CAAC,mBAAjB,wBACI,oCAEI,mCACI,WAAI,KAAK,CAAC,KAAV,mBADJ,cAEI,WAAI,KAAK,CAAC,KAAV,wBAFJ,cAGI,WAAI,KAAK,CAAC,KAAV,qBAHJ,cAII,WAAI,KAAK,CAAC,KAAV,4BAJJ,cAKI,WAAI,KAAK,CAAC,KAAV,sBALJ,GAFJ,EADJ,cAYI,uBAES,KAAKzD,KAAL,CAAWE,gBAAX,CAA4BqC,GAA5B,CAAgC,SAACC,CAAD,CAAI1B,CAAJ,CAAU,CACvC,mBACI,mCACI,iCAAI,cAAO,IAAI,CAAC,MAAZ,CAAmB,IAAI,CAAC,MAAxB,CAA+B,KAAK,CAAE,MAAI,CAACd,KAAL,CAAWE,gBAAX,CAA4BY,CAA5B,EAA+BR,IAArE,CAA2E,QAAQ,CAAE,kBAACE,CAAD,QAAO,CAAA,MAAI,CAACkD,gBAAL,CAAsBlD,CAAtB,CAAwBM,CAAxB,CAAP,EAArF,EAAJ,EADJ,cAEI,iCAAI,cAAO,IAAI,CAAC,MAAZ,CAAmB,WAAW,CAAC,YAA/B,CAAyC,IAAI,CAAC,SAA9C,CAAwD,KAAK,CAAE,MAAI,CAACd,KAAL,CAAWE,gBAAX,CAA4BY,CAA5B,EAA+BG,OAA9F,CAAuG,QAAQ,CAAE,kBAACT,CAAD,QAAO,CAAA,MAAI,CAACkD,gBAAL,CAAsBlD,CAAtB,CAAwBM,CAAxB,CAAP,EAAjH,EAAJ,EAFJ,cAGI,iCAAI,cAAO,IAAI,CAAC,SAAZ,CAAsB,WAAW,CAAC,SAAlC,CAA4C,IAAI,CAAC,SAAjD,CAA2D,KAAK,CAAE,MAAI,CAACd,KAAL,CAAWE,gBAAX,CAA4BY,CAA5B,EAA+BI,OAAjG,CAA0G,QAAQ,CAAE,kBAACV,CAAD,QAAO,CAAA,MAAI,CAACkD,gBAAL,CAAsBlD,CAAtB,CAAwBM,CAAxB,CAAP,EAApH,EAAJ,EAHJ,cAII,iCAAI,cAAO,IAAI,CAAC,MAAZ,CAAmB,IAAI,CAAC,cAAxB,CAAuC,KAAK,CAAE,MAAI,CAACd,KAAL,CAAWE,gBAAX,CAA4BY,CAA5B,EAA+BK,YAA7E,CAA2F,QAAQ,CAAE,kBAACX,CAAD,QAAO,CAAA,MAAI,CAACkD,gBAAL,CAAsBlD,CAAtB,CAAwBM,CAAxB,CAAP,EAArG,EAAJ,EAJJ,cAKI,iCACI,eAAQ,IAAI,CAAC,QAAb,CAAsB,SAAS,CAAC,4BAAhC,CAA6D,cAAY,QAAzE,CAAkF,OAAO,CAAE,yBAAM,CAAA,MAAI,CAAC6C,UAAL,CAAgB7C,CAAhB,CAAN,EAA3F,uBACI,UAAG,SAAS,CAAC,cAAb,EADJ,EADJ,EALJ,GAASA,CAAT,CADJ,CAaH,CAdA,CAFT,EAZJ,GAFJ,GADJ,EA5CR,cAmFgB,YAAK,KAAK,CAAC,iBAAX,uBACI,eAAQ,IAAI,CAAC,QAAb,CAAsB,KAAK,CAAC,2BAA5B,CAAwD,OAAO,CAAE,yBAAM,CAAA,MAAI,CAAC8C,SAAL,EAAN,EAAjE,gCADJ,EAnFhB,GADJ,EADJ,CA6FH,C,wBAlMoBjE,KAAK,CAACkE,S,EAqM/B,cAAejE,CAAAA,UAAU,CAACE,UAAD,CAAzB","sourcesContent":["import React from 'react'\nimport './CreateBill.css'\nimport {withRouter } from \"react-router-dom\";\nimport * as fromBillsApi from '../../api/bills'\n\n\nclass CreateBill extends React.Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            fraisforfait: [],\n            fraishorsforfait: [],\n            nightsQty:0,\n            repasQty:0,\n            kmQty:0,\n            date:'',\n            anneeMois:''            \n        }\n\n    }\n\n    handleChange(e){\n        e.preventDefault()\n        let name = e.target.name\n        this.setState({\n            [name]: e.target.value\n        })\n    }\n\n    handleRowsChange(e, i){\n        e.preventDefault()\n        let {name, value } = e.target\n        let fraishorsforfait = [...this.state.fraishorsforfait]\n        fraishorsforfait[i] = {\n            ...fraishorsforfait[i],\n            [name] : value\n        }\n        this.setState({\n            fraishorsforfait : fraishorsforfait    \n        }, () => console.log(this.state.fraishorsforfait))\n    }\n\n    addRows() {\n        this.setState({\n            fraishorsforfait: [...this.state.fraishorsforfait, {date: '', libelle: '', montant: '', justificatif: '' }]\n        })\n    }\n    removeRows(i){\n        let row = this.state.fraishorsforfait\n        row.splice(i,1)\n        this.setState({\n            fraishorsforfait:row\n        })\n    }\n\n    \n\n    async postFiche(){\n        let idUser = localStorage.getItem('id')\n        \n        let fiche = await fromBillsApi.postAddFiche({idutilisateur : idUser, mois: this.state.anneeMois, nbJustificatifs: \"1\" ,montantValide :this.state.nightsQty*80+this.state.repasQty*29+this.state.kmQty*0.6 , dateModif : this.state.date , idEtat : 'CR'})\n\n       \n        //let fiche = await fromBillsApi.postAddFiche({idutilisateur : idUser, mois: this.state.anneeMois, nbJustificatifs : '5', montantValide : '70.00', dateModif : '2021-04-04', idEtat : 'CR'})\n        let km = await fromBillsApi.postLigneFraisForfait({idutilisateur : idUser, mois: this.state.anneeMois, idFraisForfait : 'KM', quantite : this.state.kmQty})\n        let night = await fromBillsApi.postLigneFraisForfait({idutilisateur : idUser, mois: this.state.anneeMois, idFraisForfait : 'NUI', quantite : this.state.nightsQty})\n        let meals = await fromBillsApi.postLigneFraisForfait({idutilisateur : idUser, mois: this.state.anneeMois, idFraisForfait : 'REP', quantite : this.state.repasQty})\n        this.state.fraishorsforfait.map(async (f,i) => {\n            let horsforfait = await fromBillsApi.postLigneFraisHorsForfait({idutilisateur : idUser, mois: this.state.anneeMois, libelle : f.libelle, date : f.date, montant : f.montant, justificatif : f.libelle})\n\n        })\n        \n        this.props.history.push('/accueil')\n        \n    }\n\n\n\n    async componentDidMount() {\n        \n        let months = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre']\n        let numMonth = new Date().getMonth()\n        let year = new Date().getFullYear()\n        let monthText\n        months.map((month, i) => {\n            if(i == numMonth) monthText = month\n        })\n\n\n        let tabMois = ['01','02', '03', '04', '05', '06','07','08','09','10','11','12',]\n        let numMois = new Date().getMonth()\n        let mois \n        tabMois.map((num, i) => {\n            if (i == numMois) mois = num\n        })\n            \n        this.setState({\n            date : ` de ${monthText} ${year}`,\n            anneeMois : year + mois\n        })\n\n    }\n\n\n\n    render() {\n        return (\n            <main className=\"flex-shrink-0\">\n                <div className=\"container\">\n                \n                    <h1 class=\"text-center pt100\">\n                        Fiche de remboursement du mois {this.state.date}\n                    </h1>\n                        <hr className=\"ligne\"/>                    \n                        <h5 className=\"centrer\">Frais Forfait </h5>\n                        <div className=\"card border-primary\">\n                            <div className=\"card-body\">\n                                <table className=\"table text-center\">\n                                    <thead>\n                                        <tr>\n                                            <th scope=\"col\">Frais </th>\n                                            <th scope=\"col\">Quantité</th>\n                                            <th scope=\"col\">Montant unitaire</th>\n                                            <th scope=\"col\">Total</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <tr>\n                                            <td><label className=\"form-control-label\"><strong>Nuitées</strong></label></td>\n                                            <td><input type=\"text\" name=\"nightsQty\" placeholder=\"Qté\" value={this.state.nightsQty} onChange={(e) => this.handleChange(e)} /></td>\n                                            <td>80€</td>\n                                            <td>{this.state.nightsQty * 80}€</td>\n                                        </tr>\n                                        <tr>\n                                            <td><label for=\"\" className=\"form-control-label\"><strong>Repas</strong></label></td>\n                                            <td><input type=\"text\" name=\"repasQty\" placeholder=\"Qté\" value={this.state.repasQty} onChange={(e) => this.handleChange(e)} /></td>\n                                            <td>29€</td>\n                                            <td>{this.state.repasQty * 29}</td>\n                                        </tr>\n                                        <tr>\n                                            <td><label for=\"\" className=\"form-control-label\"><strong>Kilométrage</strong></label></td>\n                                            <td><input type=\"text\" name=\"kmQty\" placeholder=\"Qté\" value={this.state.kmQty} onChange={(e) => this.handleChange(e)}/></td>\n                                            <td>0.6€</td>\n                                            <td>{this.state.kmQty * 0.6}</td>\n                                        </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n\n                        <br />\n                        <h5 className=\"centrer\">Frais Hors Forfait </h5>\n                        <div className=\"card border-primary\">\n                            <div className=\"card-body\">\n                            <button type=\"button\" className=\"btn btn-success btn-sm\" onClick={() => this.addRows()}>Ajoutez un frais hors forfait</button>\n                                <table className=\"table text-center\">\n                                    <thead>                                \n                                    \n                                        <tr>\n                                            <th scope=\"col\">Dates</th>\n                                            <th scope=\"col\">Libellé</th>\n                                            <th scope=\"col\">Montant</th>\n                                            <th scope=\"col\"> Justificatifs</th>\n                                            <th scope=\"col\"> Actions</th>\n                                        </tr>\n                                    </thead>\n                                    \n                                    <tbody>\n                                        {\n                                             this.state.fraishorsforfait.map((f, i) => {\n                                                return (\n                                                    <tr key={i}>\n                                                        <td><input type=\"date\" name=\"date\" value={this.state.fraishorsforfait[i].date} onChange={(e) => this.handleRowsChange(e,i)}/></td>\n                                                        <td><input type=\"text\" placeholder=\"Libellé\" name=\"libelle\" value={this.state.fraishorsforfait[i].libelle} onChange={(e) => this.handleRowsChange(e,i)}/></td>\n                                                        <td><input type=\"text   \" placeholder=\"Montant\" name=\"montant\" value={this.state.fraishorsforfait[i].montant} onChange={(e) => this.handleRowsChange(e,i)}/></td>\n                                                        <td><input type=\"file\" name=\"justificatif\" value={this.state.fraishorsforfait[i].justificatif} onChange={(e) => this.handleRowsChange(e,i)}/></td>\n                                                        <td>\n                                                            <button type=\"button\" className=\"btn btn-danger btn-sm mr-2\" data-action=\"delete\" onClick={() => this.removeRows(i)}>\n                                                                <i className=\"fas fa-trash\"></i>\n                                                            </button>\n                                                        </td>\n                                                    </tr>\n                                                )\n                                            })\n                                        }   \n\n                                    </tbody>\n                                </table>\n                                \n                            </div>\n                        </div>\n                                <div class=\"col text-center\">\n                                    <button type=\"submit\" class=\"btn btn-primary mt-3 mb-3\" onClick={() => this.postFiche()}>Créer la fiche </button>\n                                </div>\n                    \n                    </div>\n\n        </main>\n        )\n    }\n}\n\nexport default withRouter(CreateBill);"]},"metadata":{},"sourceType":"module"}